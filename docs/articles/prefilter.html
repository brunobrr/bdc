<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pre-filter • bdc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pre-filter">
<meta property="og:description" content="bdc">
<meta property="og:image" content="https://brunobrr.github.io/bdc/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bdc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/integrate_datasets.html">Standardization and integration of different datasets</a>
    </li>
    <li>
      <a href="../articles/prefilter.html">Pre-filter</a>
    </li>
    <li>
      <a href="../articles/taxonomy.html">Taxonomy</a>
    </li>
    <li>
      <a href="../articles/space.html">Space</a>
    </li>
    <li>
      <a href="../articles/time.html">Time</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brunobrr/bdc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="prefilter_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="prefilter_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="prefilter_files/datatables-binding-0.21/datatables.js"></script><link href="prefilter_files/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="prefilter_files/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="prefilter_files/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="prefilter_files/dt-ext-fixedcolumns-1.11.3/css/fixedColumns.dataTables.min.css" rel="stylesheet">
<script src="prefilter_files/dt-ext-fixedcolumns-1.11.3/js/dataTables.fixedColumns.min.js"></script><link href="prefilter_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="prefilter_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Pre-filter</h1>
            
            <h4 data-toc-skip class="date">2022-03-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brunobrr/bdc/blob/HEAD/vignettes/prefilter.Rmd" class="external-link"><code>vignettes/prefilter.Rmd</code></a></small>
      <div class="hidden name"><code>prefilter.Rmd</code></div>

    </div>

    
    
<div class="section level4">
<h4 id="introduction">
<strong>Introduction</strong><a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>Large and heterogeneous datasets may contain thousands of records
missing spatial or taxonomic information (partially or entirely) as well
as several records outside a region of interest or from doubtful
sources. Such lower quality data are not fit for use in many research
applications without prior amendments. The ‘Pre-filter’ module contains
a series of <strong>tests to detect, remove, and, whenever, possible,
correct such erroneous or suspect records</strong>.</p>
</div>
<div class="section level4">
<h4 id="installation">
<strong>Installation</strong><a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>Check <a href="https://brunobrr.github.io/bdc/#installation"><strong>here</strong></a>
how to install the bdc package.</p>
</div>
<div class="section level4">
<h4 id="reading-the-database">
<strong>Reading the database</strong><a class="anchor" aria-label="anchor" href="#reading-the-database"></a>
</h4>
<p>Read the merged database created in the module
<strong>Standardization and integration of different datasets</strong>
of the <em>bdc</em> package. It is also possible to read any datasets
containing the <strong>required</strong> fields to run the functions
(more details <a href="https://brunobrr.github.io/bdc/articles/integrate_datasets.html">here</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">database</span> <span class="op">&lt;-</span>
  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"Output/Intermediate/00_merged_database.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-0697e0513657c618177e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0697e0513657c618177e">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["AT_EPIPHYTES_1","AT_EPIPHYTES_2","AT_EPIPHYTES_3","AT_EPIPHYTES_4","AT_EPIPHYTES_5","AT_EPIPHYTES_6","AT_EPIPHYTES_7","AT_EPIPHYTES_8","AT_EPIPHYTES_9","AT_EPIPHYTES_10","AT_EPIPHYTES_11","AT_EPIPHYTES_12","AT_EPIPHYTES_13","AT_EPIPHYTES_14","AT_EPIPHYTES_15"],["Tillandsia tenuifolia","Peperomia obtusifolia","Tillandsia recurvata","Vriesea flammea","Lankesterella ceracifolia","Vriesea psittacina","Nidularium innocentii","Acianthera serpentula","Peperomia quadrifolia","Peperomia circinnata","Microgramma squamulosa","Vriesea gigantea","Aechmea leptantha","Vriesea tijucana","Rhodospatha oblongata"],[-25.521863,-14.65972,-21.746667,-23.35,-28.1667,-15.133333,-26.1833,-25.5839,-26.46,-23.7869,-25.666271,-29.6411,-8.0022,-15.158634,-14.49],[-51.416667,-39.14972,-43.354722,-44.858333,-49.4,-38.333333,-49.0333,-49.6356,-49.41,-54.2836,-49.269229,-50.4525,-35.0183,-39.057151,-39.1],["E8802","635992","E1617","E0272","17541","E32704","20521","E23503","E18657","E16998","E7552","E0829","E1518","359","E25916"],["2003","2015","2016","2011","2009",null,"2009",null,null,null,"2017",null,null,"2000",null],["Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil"],["PARANA","BAHIA","MATO GROSSO DO SUL","SAO PAULO","SANTA CATARINA","BAHIA","SANTA CATARINA","PARANA","SANTA CATARINA","MATO GROSSO DO SUL","PARANA","RIO GRANDE DO SUL","PERNAMBUCO","BAHIA","BAHIA"],["GUARAPUAVA","ILHEUS","JUIZ DE FORA","UBATUBA","ORLEANS","UNA","JOINVILLE","BALSA NOVA","CORUPA","ELDORADO","FAZENDA RIO GRANDE","RIOZINHO","SAO LOURENCO DA MATA","UNA","URUCUCA"],["Rio Sao Jeronimo",null,"Praca Mariano Procopio","Parque Estadual da Serra do Mar-Nucleo Picinguaba","Rio Minador","Serra Javi. 9Km ao S Sao Jose -Km 550-; 5.5Km a E BR-101, p/ Faz. Cascavel.","Serra Dona Francisca","Base da Serra de Sao Luiz do Puruna","Palmeiras II",null,"Fazenda Experimental Gralha Azul 2",null,"Sao Bento","Reserva Biologica de Una","Mun&gt;. Urucuca, 9.4 KM. Serra do Conduru vertente E."],["Forest fragment","Coordinates given in the herbarium record","50","Forest fragment","Municipality","Coordinates given in the herbarium record","Municipality","Coordinates given in the herbarium record","Coordinates given in the herbarium record","Coordinates given in the herbarium record","Forest fragment","Municipality","Coordinates given in the herbarium record","20","Coordinates given in the herbarium record"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>database_id<\/th>\n      <th>scientificName<\/th>\n      <th>decimalLatitude<\/th>\n      <th>decimalLongitude<\/th>\n      <th>occurrenceID<\/th>\n      <th>verbatimEventDate<\/th>\n      <th>country<\/th>\n      <th>stateProvince<\/th>\n      <th>county<\/th>\n      <th>locality<\/th>\n      <th>coordinatePrecision<\/th>\n      <th>basisOfRecord<\/th>\n      <th>identifiedBy<\/th>\n      <th>coordinateUncertaintyInMeters<\/th>\n      <th>recordedBy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":[3,4,14]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>⚠️<strong>IMPORTANT:</strong></p>
<p>The results of the <strong>VALIDATION</strong> test used to flag data
quality are appended in separate fields in this database and retrieved
as TRUE ( ✅ ok ) or <strong>FALSE</strong> (❌check carefully ).</p>
</div>
<div class="section level4">
<h4 id="records-missing-species-names">
<strong>1 - Records missing species names</strong><a class="anchor" aria-label="anchor" href="#records-missing-species-names"></a>
</h4>
<p><em>VALIDATION</em>. Flag records missing species names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_scientificName_empty.html">bdc_scientificName_empty</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">database</span>,
  sci_name <span class="op">=</span> <span class="st">"scientificName"</span><span class="op">)</span>

<span class="co">#&gt; bdc_scientificName_empty:</span>
<span class="co">#&gt; Flagged 5 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="records-lacking-information-on-geographic-coordinates">
<strong>2 - Records lacking information on geographic
coordinates</strong><a class="anchor" aria-label="anchor" href="#records-lacking-information-on-geographic-coordinates"></a>
</h4>
<p><em>VALIDATION</em>. Flag records missing partial or complete
information on geographic coordinates.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_empty.html">bdc_coordinates_empty</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span>

<span class="co">#&gt; bdc_coordinates_empty:</span>
<span class="co">#&gt; Flagged 44 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="records-with-out-of-range-coordinates">
<strong>3 - Records with out-of-range coordinates</strong><a class="anchor" aria-label="anchor" href="#records-with-out-of-range-coordinates"></a>
</h4>
<p><em>VALIDATION</em>. This test flags records with out-of-range
coordinates: latitude &gt; 90 or -90; longitude &gt;180 or -180.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_outOfRange.html">bdc_coordinates_outOfRange</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span><span class="op">)</span>

<span class="co">#&gt; bdc_coordinates_outOfRange:</span>
<span class="co">#&gt; Flagged 1 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="records-from-doubtful-sources">
<strong>4 - Records from doubtful sources</strong><a class="anchor" aria-label="anchor" href="#records-from-doubtful-sources"></a>
</h4>
<p><em>VALIDATION</em>. This test flags records from doubtful source.
For example, records from drawings, photographs, or multimedia objects,
fossil records, among others.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check record sources of your dataset using:</span>
<span class="co"># check_pf %&gt;%</span>
<span class="co">#   dplyr::group_by(basisOfRecord) %&gt;%</span>
<span class="co">#   dplyr::summarise(n = dplyr::n())</span>

<span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_basisOfRecords_notStandard.html">bdc_basisOfRecords_notStandard</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  basisOfRecord <span class="op">=</span> <span class="st">"basisOfRecord"</span>,
  names_to_keep <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>

<span class="co">#&gt; bdc_basisOfRecords_notStandard:</span>
<span class="co">#&gt; Flagged 0 of the following specific nature:</span>
<span class="co">#&gt;  character(0)</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="getting-country-names-from-valid-coordinates">
<strong>5 - Getting country names from valid
coordinates</strong><a class="anchor" aria-label="anchor" href="#getting-country-names-from-valid-coordinates"></a>
</h4>
<p><em>ENRICHMENT</em>. Deriving country names for records missing
country names.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_country_from_coordinates.html">bdc_country_from_coordinates</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
  country <span class="op">=</span> <span class="st">"country"</span><span class="op">)</span>

<span class="co">#&gt; bdc_country_from_coordinates:</span>
<span class="co">#&gt; Country names were added to 27 records.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="standardizing-country-names-and-getting-country-code-information">
<strong>6 - Standardizing country names and getting country code
information</strong><a class="anchor" aria-label="anchor" href="#standardizing-country-names-and-getting-country-code-information"></a>
</h4>
<p><em>ENRICHMENT</em>. Country names are standardized against a list of
country names in several languages retrieved from Wikipedia.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_country_standardized.html">bdc_country_standardized</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  country <span class="op">=</span> <span class="st">"country"</span>
<span class="op">)</span>

<span class="co">#&gt; Standardizing country names</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; country found: Bolivia</span>
<span class="co">#&gt; country found: Brazil</span>
<span class="co">#&gt;   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s</span>
<span class="co">#&gt;   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s</span>
<span class="co">#&gt;   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; bdc_country_standardized:</span>
<span class="co">#&gt; The country names of 65 records were standardized.</span>
<span class="co">#&gt; Two columns ('country_suggested' and 'countryCode') were added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="correcting-latitude-and-longitude-transposed">
<strong>7 - Correcting latitude and longitude
transposed</strong><a class="anchor" aria-label="anchor" href="#correcting-latitude-and-longitude-transposed"></a>
</h4>
<p><em>AMENDMENT</em>. The mismatch between informed country and
coordinates can be the result of negative or transposed coordinates.
Once detected a mismatch, different coordinate transformations are made
to correct the country and coordinates mismatch. Verbatim coordinates
are then replaced by the rectified ones in the returned database (a
database containing verbatim and corrected coordinates can be created in
the “Output” folder if <code>save_outputs = TRUE</code>). Records near
countries coastline are not tested to avoid incur in false
positives.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_coordinates_transposed.html">bdc_coordinates_transposed</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">check_pf</span>,
    id <span class="op">=</span> <span class="st">"database_id"</span>,
    sci_names <span class="op">=</span> <span class="st">"scientificName"</span>,
    lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
    lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
    country <span class="op">=</span> <span class="st">"country_suggested"</span>,
    countryCode <span class="op">=</span> <span class="st">"countryCode"</span>,
    border_buffer <span class="op">=</span> <span class="fl">0.2</span>, <span class="co"># in decimal degrees (~22 km at the equator)</span>
    save_outputs <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>

<span class="co">#&gt; Correcting latitude and longitude transposed</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; 15 occurrences will be tested</span>
<span class="co">#&gt; Processing occurrences from: BR (15)</span>
<span class="co">#&gt; No latitude and longitude were transposed</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="records-outside-a-region-of-interest">
<strong>8 - Records outside a region of interest</strong><a class="anchor" aria-label="anchor" href="#records-outside-a-region-of-interest"></a>
</h4>
<p><em>VALIDATION</em>. Records outside one or multiple reference
countries; i.e., records in other countries or at an informed distance
from the coast (e.g., in the ocean). This last step avoids flagging as
invalid records close to country limits (e.g., records of coast or
marshland species).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_coordinates_country_inconsistent.html">bdc_coordinates_country_inconsistent</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">check_pf</span>,
    country_name <span class="op">=</span> <span class="st">"Brazil"</span>,
    lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
    lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
    dist <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># in decimal degrees (~11 km at the equator)</span>
  <span class="op">)</span>

<span class="co">#&gt; dist is assumed to be in decimal degrees (arc_degrees).</span>
<span class="co">#&gt; although coordinates are longitude/latitude, st_intersection assumes that they are planar</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; bdc_coordinates_country_inconsistent:</span>
<span class="co">#&gt; Flagged 15 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="identifying-records-not-geo-referenced-but-containing-locality-information">
<strong>9 - Identifying records not geo-referenced but containing
locality information</strong><a class="anchor" aria-label="anchor" href="#identifying-records-not-geo-referenced-but-containing-locality-information"></a>
</h4>
<p><em>ENRICHMENT</em>. Coordinates can be derived from a detailed
description of the locality associated with records in a process called
retrospective geo-referencing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xyFromLocality</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_coordinates_from_locality.html">bdc_coordinates_from_locality</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">check_pf</span>,
  locality <span class="op">=</span> <span class="st">"locality"</span>,
  lon <span class="op">=</span> <span class="st">"decimalLongitude"</span>,
  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,
  save_outputs <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="co">#&gt; bdc_coordinates_from_locality</span>
<span class="co">#&gt; Found 38 records missing or with invalid coordinates but with potentially useful information on locality</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="report">
<strong>Report</strong><a class="anchor" aria-label="anchor" href="#report"></a>
</h4>
<p>Here we create a column named “.summary” summing up the results of
all <strong>VALIDATION</strong> tests (those starting with “.”). This
column is <strong>FALSE</strong> when a record is flagged as FALSE in
any data quality test (i.e. potentially invalid or suspect record).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_pf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_summary_col.html">bdc_summary_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span><span class="op">)</span>

<span class="co">#&gt; bdc_summary_col:</span>
<span class="co">#&gt; Flagged 65 records.</span>
<span class="co">#&gt; One column was added to the database.</span></code></pre></div>
<p>Creating a report summarizing the results of all tests. The report
can be automatically saved if <code>save_report = TRUE.</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">report</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/bdc_create_report.html">bdc_create_report</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,
                    database_id <span class="op">=</span> <span class="st">"database_id"</span>,
                    workflow_step <span class="op">=</span> <span class="st">"prefilter"</span>,
                    save_report <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">report</span></code></pre></div>
<div id="htmlwidget-498b5ffd9f7386708a93" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-498b5ffd9f7386708a93">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["1","2","3","4","5","6","7"],["Records with empty scientific name","Records with empty coordinates","Records with coordinates out-of-range","Records outside one or multiple reference countries","Summary of all tests",null,"(*) calculated in relation to total number of records, i.e. 180 records"],[".scientificName_empty",".coordinates_empty",".coordinates_outOfRange",".coordinates_country_inconsistent",".summary",null,null],[5,44,1,15,65,null,null],[2.78,24.44,0.56,8.33,36.11,null,null]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Description<\/th>\n      <th>Test_name<\/th>\n      <th>Records_flagged<\/th>\n      <th>perc_number_records(*)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":[3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="figures">
<strong>Figures</strong><a class="anchor" aria-label="anchor" href="#figures"></a>
</h4>
<p>Here we create figures (bar plots and maps) to make the
interpretation of the results of data quality tests easier. See some
examples below. Figures can be automatically saved if
<code>save_figures = TRUE.</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">figures</span> <span class="op">&lt;-</span>
<span class="fu"><a href="../reference/bdc_create_figures.html">bdc_create_figures</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_pf</span>,
                   database_id <span class="op">=</span> <span class="st">"database_id"</span>,
                   workflow_step <span class="op">=</span> <span class="st">"prefilter"</span>,
                   save_figures <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Check figures using</span>
<span class="va">figures</span><span class="op">$</span><span class="va">.coordinates_country_inconsistent</span></code></pre></div>
<div class="figure">
<img src="https://raw.githubusercontent.com/brunobrr/bdc/master/vignettes/images/prefilter_.coordinates_country_inconsistent_MAP.png" alt=""><p class="caption">Coordinates country inconsistent</p>
</div>
<p><br></p>
<div class="figure">
<img src="https://raw.githubusercontent.com/brunobrr/bdc/master/vignettes/images/prefilter_summary_all_tests_BAR.png" alt=""><p class="caption">Summary of all tests of the pre-filter step</p>
</div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="filtering-the-database">
<strong>Filtering the database</strong><a class="anchor" aria-label="anchor" href="#filtering-the-database"></a>
</h4>
<p>We can remove records flagged as erroneous or suspect to obtain a
“clean” database. Records missing names or coordinates, outside a region
of interest or from distrustful sources are rarely suitable for
biodiversity analyses. We can use the column <strong>.summary</strong>
to filter valid records passing in all tests (i.e., flagged as “TRUE”).
Next, we use the <em>bdc_filter_out_falgs</em> function to remove all
tests’ columns (that is, those starting with “.”).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span>
  <span class="va">check_pf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.summary</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/bdc_filter_out_flags.html">bdc_filter_out_flags</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, col_to_remove <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>

<span class="co">#&gt; bdc_fiter_out_flags:</span>
<span class="co">#&gt; The following columns were removed from the database:</span>
<span class="co">#&gt; .scientificName_empty, .coordinates_empty, .coordinates_outOfRange, .basisOfRecords_notStandard, .coordinates_country_inconsistent, .summary</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="saving-the-database">
<strong>Saving the database</strong><a class="anchor" aria-label="anchor" href="#saving-the-database"></a>
</h4>
<p>You can use <u>qs::qsave()</u> instead of write_csv to save a large
database in a compressed format.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use qs::qsave() to save the database in a compressed format and then qs:qread() to load the database</span>
<span class="va">output</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">.</span>,
            <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"Output"</span>, <span class="st">"Intermediate"</span>, <span class="st">"01_prefilter_database.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bruno Ribeiro, Geiziane Tessarolo, Santiago Velazco,
Lucas Jardim, Karlo Guidoni-Martins.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
