<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taxonomy • bdc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Taxonomy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bdc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-book"></span>

    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/integrate_datasets.html">Standardization and integration of different datasets</a>
    </li>
    <li>
      <a href="../articles/prefilter.html">Pre-filter</a>
    </li>
    <li>
      <a href="../articles/taxonomy.html">Taxonomy</a>
    </li>
    <li>
      <a href="../articles/space.html">Space</a>
    </li>
    <li>
      <a href="../articles/time.html">Time</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/help/installing_gnparser.html">
    <span class="fas fa-question-circle"></span>

    Help
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brunobrr/bdc/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="taxonomy_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="taxonomy_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="taxonomy_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="taxonomy_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="taxonomy_files/datatables-binding-0.33/datatables.js"></script><link href="taxonomy_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="taxonomy_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="taxonomy_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="taxonomy_files/dt-ext-fixedcolumns-1.13.6/css/fixedColumns.dataTables.min.css" rel="stylesheet">
<script src="taxonomy_files/dt-ext-fixedcolumns-1.13.6/js/dataTables.fixedColumns.min.js"></script><link href="taxonomy_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="taxonomy_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Taxonomy</h1>
            
            <h4 data-toc-skip class="date">2024-11-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/brunobrr/bdc/blob/master/vignettes/articles/taxonomy.Rmd" class="external-link"><code>vignettes/articles/taxonomy.Rmd</code></a></small>
      <div class="hidden name"><code>taxonomy.Rmd</code></div>

    </div>

    
    
<div class="section level4">
<h4 id="introduction">
<strong>Introduction</strong><a class="anchor" aria-label="anchor" href="#introduction"></a>
</h4>
<p>The combination of large datasets from several sources requires careful harmonization of taxon names. Non-standardized, incorrect, ambiguous, or synonymous taxonomic names can lead to <strong>unreliable results and conclusions</strong>. The <em>bdc</em> package includes tools to help standardize <strong>major taxonomic groups’ names</strong> (e.g., animals and plants) by comparing scientific names against <strong>one out of 10 taxonomic databases</strong>. The taxonomic harmonization process borrows heavily from <a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13440" class="external-link">Norman et al. (2020); taxadb package)</a>, which contains functions that allow <strong>querying millions of taxonomic names</strong> in a fast, automated, and consistent way using high-quality locally stored taxonomic databases.</p>
<p>The functions used to harmonize names (<em>bdc_clean_name</em> and <em>bdc_query_names_taxadb</em>) <strong>contain several additions to the <em>taxadb</em> package</strong>, including tools for:</p>
<ol style="list-style-type: decimal">
<li>Cleaning and parsing scientific names;</li>
<li>Resolving misspelled names or variant spellings using a fuzzy matching application;</li>
<li>Converting nomenclatural synonyms to current accepted name;</li>
<li>Flagging ambiguous results;</li>
<li>Reporting the results.</li>
</ol>
<p>The taxonomic harmonization is based on one taxonomic database chosen by the user. <em>taxadb</em> makes available the following taxonomic sources:</p>
<table class="table">
<thead><tr class="header">
<th>Abbreviation</th>
<th>Taxonomic database</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>col</td>
<td>Catalogue of Life</td>
</tr>
<tr class="even">
<td>fb</td>
<td>FishBase</td>
</tr>
<tr class="odd">
<td>itis</td>
<td>Integrated Taxonomic Information System</td>
</tr>
<tr class="even">
<td>iucn</td>
<td>International Union for Conservation of Nature’s Red List</td>
</tr>
<tr class="odd">
<td>gbif</td>
<td>Global Biodiversity Information Facility</td>
</tr>
<tr class="even">
<td>ncbi</td>
<td>National Center for Biotechnology Information</td>
</tr>
<tr class="odd">
<td>ott</td>
<td>OpenTree Taxonomy</td>
</tr>
<tr class="even">
<td>tpl</td>
<td>The Plant List</td>
</tr>
<tr class="odd">
<td>slb</td>
<td>SeaLifeBase</td>
</tr>
<tr class="even">
<td>wd</td>
<td>Wikidata</td>
</tr>
</tbody>
</table>
<p>⚠️<strong>IMPORTANT:</strong></p>
<p>Note that some taxonomic databases may be <em>momentarily unavailable</em> in taxadb. Check ?bdc_query_names_taxadb for a list of available taxonomic databases.</p>
</div>
<div class="section level4">
<h4 id="installation">
<strong>Installation</strong><a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>Check <a href="https://brunobrr.github.io/bdc/#installation"><strong>here</strong></a> how to install the bdc package.</p>
</div>
<div class="section level4">
<h4 id="reading-the-database">
<strong>Reading the database</strong><a class="anchor" aria-label="anchor" href="#reading-the-database"></a>
</h4>
<p>Read the database created in the <a href="https://brunobrr.github.io/bdc/articles/prefilter.html"><strong>Pre-filter</strong></a> module of the <em>bdc</em> package. It is also possible to read any datasets containing the <strong>required</strong> fields to run the package (more details <a href="https://brunobrr.github.io/bdc/articles/integrate_datasets.html">here</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">database</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"Output/Intermediate/01_prefilter_database.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["AT_EPIPHYTES_1","AT_EPIPHYTES_2","AT_EPIPHYTES_3","AT_EPIPHYTES_4","AT_EPIPHYTES_5","AT_EPIPHYTES_7","AT_EPIPHYTES_8","AT_EPIPHYTES_9","AT_EPIPHYTES_10","AT_EPIPHYTES_11","AT_EPIPHYTES_12","AT_EPIPHYTES_13","AT_EPIPHYTES_14","AT_EPIPHYTES_15","AT_EPIPHYTES_16"],["Tillandsia tenuifolia","Peperomia obtusifolia","Tillandsia recurvata","Vriesea flammea","Lankesterella ceracifolia","Nidularium innocentii","Acianthera serpentula","Peperomia quadrifolia","Peperomia circinnata","Microgramma squamulosa","Vriesea gigantea","Aechmea leptantha","Vriesea tijucana","Rhodospatha oblongata","Anthurium gaudichaudianum"],[-25.521863,-14.65972,-21.746667,-23.35,-28.1667,-26.1833,-25.5839,-26.46,-23.7869,-25.666271,-29.6411,-8.0022,-15.158634,-14.49,-29.342087],[-51.416667,-39.14972,-43.354722,-44.858333,-49.4,-49.0333,-49.6356,-49.41,-54.2836,-49.269229,-50.4525,-35.0183,-39.057151,-39.1,-49.68663],["E8802","635992","E1617","E0272","17541","20521","E23503","E18657","E16998","E7552","E0829","E1518","359","E25916","E0057"],["2003","2015","2016","2011","2009","2009",null,null,null,"2017",null,null,"2000",null,"1992"],["Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil"],["PARANA","BAHIA","MATO GROSSO DO SUL","SAO PAULO","SANTA CATARINA","SANTA CATARINA","PARANA","SANTA CATARINA","MATO GROSSO DO SUL","PARANA","RIO GRANDE DO SUL","PERNAMBUCO","BAHIA","BAHIA","RIO GRANDE DO SUL"],["GUARAPUAVA","ILHEUS","JUIZ DE FORA","UBATUBA","ORLEANS","JOINVILLE","BALSA NOVA","CORUPA","ELDORADO","FAZENDA RIO GRANDE","RIOZINHO","SAO LOURENCO DA MATA","UNA","URUCUCA","TORRES"],["Rio Sao Jeronimo",null,"Praca Mariano Procopio","Parque Estadual da Serra do Mar-Nucleo Picinguaba","Rio Minador","Serra Dona Francisca","Base da Serra de Sao Luiz do Puruna","Palmeiras II",null,"Fazenda Experimental Gralha Azul 2",null,"Sao Bento","Reserva Biologica de Una","Mun&gt;. Urucuca, 9.4 KM. Serra do Conduru vertente E.","Torres"],["Forest fragment","Coordinates given in the herbarium record","50","Forest fragment","Municipality","Municipality","Coordinates given in the herbarium record","Coordinates given in the herbarium record","Coordinates given in the herbarium record","Forest fragment","Municipality","Coordinates given in the herbarium record","20","Coordinates given in the herbarium record","Forest fragment"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil","Brazil"],["BR","BR","BR","BR","BR","BR","BR","BR","BR","BR","BR","BR","BR","BR","BR"]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th>database_id<\/th>\n      <th>scientificName<\/th>\n      <th>decimalLatitude<\/th>\n      <th>decimalLongitude<\/th>\n      <th>occurrenceID<\/th>\n      <th>verbatimEventDate<\/th>\n      <th>country<\/th>\n      <th>stateProvince<\/th>\n      <th>county<\/th>\n      <th>locality<\/th>\n      <th>coordinatePrecision<\/th>\n      <th>basisOfRecord<\/th>\n      <th>identifiedBy<\/th>\n      <th>coordinateUncertaintyInMeters<\/th>\n      <th>recordedBy<\/th>\n      <th>country_suggested<\/th>\n      <th>countryCode<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":3,"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":[2,3,13]},{"name":"database_id","targets":0},{"name":"scientificName","targets":1},{"name":"decimalLatitude","targets":2},{"name":"decimalLongitude","targets":3},{"name":"occurrenceID","targets":4},{"name":"verbatimEventDate","targets":5},{"name":"country","targets":6},{"name":"stateProvince","targets":7},{"name":"county","targets":8},{"name":"locality","targets":9},{"name":"coordinatePrecision","targets":10},{"name":"basisOfRecord","targets":11},{"name":"identifiedBy","targets":12},{"name":"coordinateUncertaintyInMeters","targets":13},{"name":"recordedBy","targets":14},{"name":"country_suggested","targets":15},{"name":"countryCode","targets":16}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[3,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="clean-and-parse-species-names">
<strong>Clean and parse species names</strong><a class="anchor" aria-label="anchor" href="#clean-and-parse-species-names"></a>
</h4>
<p>⚠️<strong>IMPORTANT:</strong></p>
<p>Before running the <code>bdc_clean_names</code> function, please, install the <code>gnparser</code> software by <a href="https://brunobrr.github.io/bdc/articles/help/installing_gnparser.html"><strong>following this tutorial</strong></a><strong>.</strong> More information on gnparser is available on the <a href="https://github.com/gnames/gnparser" class="external-link">software’s GitHub</a>.</p>
<p>Scientific names improperly formatted usually cannot be matched with valid names. To solve this issue, we developed the <em>bdc_clean_name</em> containing functionalities to <strong>unify writing style of scientific names</strong>. This optimize the taxonomic queries by increasing the probability of finding matching names. This tool is used to:</p>
<ol style="list-style-type: decimal">
<li>Flag and remove family names pre-pended to species names;</li>
<li>Flag and remove qualifiers denoting uncertain or provisional status of taxonomic identification (e.g., confer, species, affinis, and among others);</li>
<li>Flag and remove infraspecific terms (e.g., variety [var.], subspecies [subsp], forma [f.], and their spelling variations);</li>
<li>Standardize names, i.e., capitalize only the first letter of the genus name and remove extra whitespaces);</li>
<li>Parse names, i.e., separate author, date, annotations from taxon name using gnpaser.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parse_names</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/bdc_clean_names.html">bdc_clean_names</a></span><span class="op">(</span>sci_names <span class="op">=</span> <span class="va">database</span><span class="op">$</span><span class="va">scientificName</span>, save_outputs <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; &gt;&gt; Family names prepended to scientific names were flagged and removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Terms denoting taxonomic uncertainty were flagged and removed from 1 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Other issues, capitalizing the first letter of the generic name, replacing empty names by NA, and removing extra spaces, were flagged and corrected or removed from 0 records.</span></span>
<span><span class="co">#&gt; &gt;&gt; Infraspecific terms were flagged and removed from 1 records.</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; &gt;&gt; Scientific names were cleaned and parsed. Check the results in 'Output/Check/02_clean_names.csv'.</span></span></code></pre></div>
<p>An example of <em>bdc_clean_names</em> output.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["Hillia parasitica Jacq.","Chresta pacourinoides (Mart. ex DC.) Loeuille, Siniscalchi &amp; Pirani","Chamaecrista incana (Vogel) H.S.Irwin &amp; Barneby","Tridax procumbens L.","Peperomia tetraphylla (G.Forst.) Hook. &amp; Arn.","Oxalis psoraleoides ssp. insipida (A.St.-Hil.) Lourteig","Xyris mucujensis Kral &amp; L.B.Sm.","Groenbladia","Byrsonima crispa","Paspalum multicaule Poir.","Solanum megalochiton Mart.","Leiothrix curvifolia (Bong.) Ruhland","Chrysophyllum inornatum Mart.","Mimosa paludosa Benth.","Myrsine umbellata","Swartzia simplex var. continentalis Urb."],[true,true,true,true,true,false,true,true,true,true,true,true,true,true,true,true],[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false],["Hillia parasitica","Chresta pacourinoides","Chamaecrista incana","Tridax procumbens","Peperomia tetraphylla","Oxalis psoraleoides insipida","Xyris mucujensis","Groenbladia","Byrsonima crispa","Paspalum multicaule","Solanum megalochiton","Leiothrix curvifolia","Chrysophyllum inornatum","Mimosa paludosa","Myrsine umbellata","Swartzia simplex continentalis"],[1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th>scientificName<\/th>\n      <th>.uncer_terms<\/th>\n      <th>.infraesp_names<\/th>\n      <th>names_clean<\/th>\n      <th>quality<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":4},{"name":"scientificName","targets":0},{"name":".uncer_terms","targets":1},{"name":".infraesp_names","targets":2},{"name":"names_clean","targets":3},{"name":"quality","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>Let’s merge the names parsed with the complete database.</strong> As the column ‘scientificName’ is in the same order in both databases (i.e., parse_names and database), we can append names parsed in the database. Also, only the columns “names_clean” and “.uncert_terms” will be used in the downstream analyses. But don’t worry, you can check the results of the parsing names process in “Output/Check/02_parsed_names.qs”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parse_names</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">parse_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.uncer_terms</span>, <span class="va">names_clean</span><span class="op">)</span></span>
<span></span>
<span><span class="va">database</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">database</span>, <span class="va">parse_names</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="names-harmonization">
<strong>Names harmonization</strong><a class="anchor" aria-label="anchor" href="#names-harmonization"></a>
</h4>
<p>The taxonomic harmonization is based upon <strong>one</strong> of those taxonomic authorities previously mentioned. It starts with creating a local database by downloading, extracting, and importing the taxonomic database informed by users using the <em>taxadb</em> package. The download may take some time, depending on the internet connection.</p>
<p>⚠️<strong>IMPORTANT:</strong> If will have a problem downloading databases, please consider removing the previous versions of taxonomic databases using <code>fs::dir_delete(taxadb:::taxadb_dir())</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bdc_query_names_taxadb.html">bdc_query_names_taxadb</a></span><span class="op">(</span></span>
<span>  sci_name            <span class="op">=</span> <span class="va">database</span><span class="op">$</span><span class="va">names_clean</span>,</span>
<span>  replace_synonyms    <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># replace synonyms by accepted names?</span></span>
<span>  suggest_names       <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># try to found a candidate name for misspelled names?</span></span>
<span>  suggestion_distance <span class="op">=</span> <span class="fl">0.9</span>, <span class="co"># distance between the searched and suggested names</span></span>
<span>  db                  <span class="op">=</span> <span class="st">"gbif"</span>, <span class="co"># taxonomic database</span></span>
<span>  rank_name           <span class="op">=</span> <span class="st">"Plantae"</span>, <span class="co"># a taxonomic rank</span></span>
<span>  rank                <span class="op">=</span> <span class="st">"kingdom"</span>, <span class="co"># name of the taxonomic rank</span></span>
<span>  parallel            <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># should parallel processing be used?</span></span>
<span>  ncores              <span class="op">=</span> <span class="fl">2</span>, <span class="co"># number of cores to be used in the parallelization process</span></span>
<span>  export_accepted     <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># save names linked to multiple accepted names</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; A total of 0 NA was/were found in sci_name.</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; 115 names queried in 3.1 minutes</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["Tillandsia tenuifolia","Peperomia obtusifolia","Tillandsia recurvata","Vriesea flammea","Lankesterella ceracifolia","Nidularium innocentii","Acianthera serpentula","Peperomia quadrifolia","Peperomia circinnata","Microgramma squamulosa","Vriesea gigantea","Aechmea leptantha","Vriesea tijucana","Rhodospatha oblongata","Anthurium gaudichaudianum","Maxillaria caparaoensis","Acianthera langeana","Pleopeltis monoides","Hymenophyllum fragile","Solanum paniculatum"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted"],["GBIF:2695114","GBIF:3086423","GBIF:2695588","GBIF:5289378","GBIF:5312267","GBIF:2697762","GBIF:2839474","GBIF:3086416","GBIF:7304921","GBIF:4025976","GBIF:5288894","GBIF:2698687","GBIF:5288897","GBIF:2871981","GBIF:2872740","GBIF:5318538","GBIF:2840033","GBIF:7495967","GBIF:2651313","GBIF:2932547"],["Tillandsia tenuifolia","Peperomia obtusifolia","Tillandsia recurvata","Vriesea flammea","Lankesterella ceracifolia","Nidularium innocentii","Acianthera serpentula","Peperomia quadrifolia","Peperomia circinnata","Microgramma squamulosa","Vriesea gigantea","Aechmea leptantha","Vriesea tijucana","Rhodospatha oblongata","Anthurium gaudichaudianum","Maxillaria caparaoensis","Acianthera langeana","Pleopeltis monoides","Hymenophyllum fragile","Solanum paniculatum"],["species","species","species","species","species","species","species","species","species","species","species","species","species","species","species","species","species","species","species","species"],["accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted","accepted"],["GBIF:2695114","GBIF:3086423","GBIF:2695588","GBIF:5289378","GBIF:5312267","GBIF:2697762","GBIF:2839474","GBIF:3086416","GBIF:7304921","GBIF:4025976","GBIF:5288894","GBIF:2698687","GBIF:5288897","GBIF:2871981","GBIF:2872740","GBIF:5318538","GBIF:2840033","GBIF:7495967","GBIF:2651313","GBIF:2932547"],["Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae","Plantae"],["Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta","Tracheophyta"],["Liliopsida","Magnoliopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Magnoliopsida","Magnoliopsida","Polypodiopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Liliopsida","Polypodiopsida","Polypodiopsida","Magnoliopsida"],["Poales","Piperales","Poales","Poales","Asparagales","Poales","Asparagales","Piperales","Piperales","Polypodiales","Poales","Poales","Poales","Alismatales","Alismatales","Asparagales","Asparagales","Polypodiales","Hymenophyllales","Solanales"],["Bromeliaceae","Piperaceae","Bromeliaceae","Bromeliaceae","Orchidaceae","Bromeliaceae","Orchidaceae","Piperaceae","Piperaceae","Polypodiaceae","Bromeliaceae","Bromeliaceae","Bromeliaceae","Araceae","Araceae","Orchidaceae","Orchidaceae","Polypodiaceae","Hymenophyllaceae","Solanaceae"],["Tillandsia","Peperomia","Tillandsia","Vriesea","Lankesterella","Nidularium","Acianthera","Peperomia","Peperomia","Microgramma","Vriesea","Aechmea","Vriesea","Rhodospatha","Anthurium","Maxillaria","Acianthera","Pleopeltis","Hymenophyllum","Solanum"],["tenuifolia","obtusifolia","recurvata","flammea","ceracifolia","innocentii","serpentula","quadrifolia","circinnata","squamulosa","gigantea","leptantha","tijucana","oblongata","gaudichaudianum","caparaoensis","langeana","monoides","fragile","paniculatum"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[8279994,3086367,8279994,2699764,2807134,2697636,7848554,3086367,3086367,8393217,2699764,2697812,2699764,2871974,2872218,2825779,7848554,2650485,2651287,2928997],[null,3086426,5287808,null,2807162,null,2839476,3086417,null,7290190,null,2698688,null,null,null,null,2840034,5649333,5533060,null],["L.","A.Dietr. (L.)","L. (L.)","L.B.Sm.","Mansf. (Barb.Rodr.)","Lem.","F.Barros (Barb.Rodr.)","Kunth (L.)","Link","de la Sota (Kaulf.)","Gaudich.","Leme &amp; J.A.Siqueira (Harms)","E.Pereira","Poepp.","Kunth","Brade","Pridgeon &amp; M.W.Chase (Kraenzl.)","Salino (Weath.)","Morton (Hedw.)","L."],["narrowleaf airplant","pepper face","Tillandsia recta o heno pequeno",null,null,"purpurvattensamlare",null,"fourleaf peperomia",null,null,"jattevriesea",null,null,null,null,null,null,null,"fragile filmy fern","jurubeba"]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th>original_search<\/th>\n      <th>suggested_name<\/th>\n      <th>distance<\/th>\n      <th>notes<\/th>\n      <th>taxonID<\/th>\n      <th>scientificName<\/th>\n      <th>taxonRank<\/th>\n      <th>taxonomicStatus<\/th>\n      <th>acceptedNameUsageID<\/th>\n      <th>kingdom<\/th>\n      <th>phylum<\/th>\n      <th>class<\/th>\n      <th>order<\/th>\n      <th>family<\/th>\n      <th>genus<\/th>\n      <th>specificEpithet<\/th>\n      <th>infraspecificEpithet<\/th>\n      <th>parentNameUsageID<\/th>\n      <th>originalNameUsageID<\/th>\n      <th>scientificNameAuthorship<\/th>\n      <th>vernacularName<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":[17,18]},{"name":"original_search","targets":0},{"name":"suggested_name","targets":1},{"name":"distance","targets":2},{"name":"notes","targets":3},{"name":"taxonID","targets":4},{"name":"scientificName","targets":5},{"name":"taxonRank","targets":6},{"name":"taxonomicStatus","targets":7},{"name":"acceptedNameUsageID","targets":8},{"name":"kingdom","targets":9},{"name":"phylum","targets":10},{"name":"class","targets":11},{"name":"order","targets":12},{"name":"family","targets":13},{"name":"genus","targets":14},{"name":"specificEpithet","targets":15},{"name":"infraspecificEpithet","targets":16},{"name":"parentNameUsageID","targets":17},{"name":"originalNameUsageID","targets":18},{"name":"scientificNameAuthorship","targets":19},{"name":"vernacularName","targets":20}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Merging results of the taxonomy harmonization process with the original database. Before that, let’s rename the column containing the original scientific names to <strong>“verbatim_scientificName”</strong>. From now on, <strong>“scientificName” corresponds to the verified names</strong> (resulted from the name harmonization process). As the column “original_search” in “query_names” and “names_clean” are equal, only the first will be kept.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">database</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">database</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>verbatim_scientificName <span class="op">=</span> <span class="va">scientificName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">names_clean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">query_names</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="report">
<strong>Report</strong><a class="anchor" aria-label="anchor" href="#report"></a>
</h4>
<p>The report is based on the <strong>column notes</strong> containing the results of the name harmonization process. The notes can be grouped into two categories: accepted names and those with a taxonomic issue or warning, needing further inspections. Accepted names are returned as “valid” in the column “Description”. The report can be automatically saved if <code>save_report = TRUE.</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/bdc_create_report.html">bdc_create_report</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">database</span>,</span>
<span>                    database_id <span class="op">=</span> <span class="st">"database_id"</span>,</span>
<span>                    workflow_step <span class="op">=</span> <span class="st">"taxonomy"</span>,</span>
<span>                    save_report <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">report</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["valid: name accepted","valid: synonym replaced by an accepted name","check: ambiguous synonym linked to multiple accepted names","check: ambiguous synonym linked to multiple accepted names","invalid: name not found in the taxonomic database or a non-interpretable name","check: doubtful taxonomic identification",null,"(*) calculated in relation to total number of records, i.e. 115 records"],["accepted","accepted | replaceSynonym","heterotypic synonym","homotypic synonym","notFound","taxo_uncer",null,null],[111,1,1,1,1,1,null,null],[96.52,0.87,0.87,0.87,0.87,0.87,null,null]],"container":"<table class=\"stripe\">\n  <thead>\n    <tr>\n      <th>Description<\/th>\n      <th>notes<\/th>\n      <th>number_of_records<\/th>\n      <th>perc_number_records(*)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Bfrtip","scrollX":true,"fixedColumns":{"leftColumns":2},"columnDefs":[{"className":"dt-right","targets":[2,3]},{"name":"Description","targets":0},{"name":"notes","targets":1},{"name":"number_of_records","targets":2},{"name":"perc_number_records(*)","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="unresolved-names">
<strong>Unresolved names</strong><a class="anchor" aria-label="anchor" href="#unresolved-names"></a>
</h4>
<p>It is also possible to filter out records with taxonomic status different from “accepted”. Such records may be potentially resolved manually.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unresolved_names</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/bdc_filter_out_names.html">bdc_filter_out_names</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">database</span>,</span>
<span>                       col_name <span class="op">=</span> <span class="st">"notes"</span>,</span>
<span>                       taxonomic_status <span class="op">=</span> <span class="st">"accepted"</span>,</span>
<span>                       opposite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Save the table containing unresolved names</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unresolved_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"Output/Check/02_unresolved_names.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtering-the-database">
<strong>Filtering the database</strong><a class="anchor" aria-label="anchor" href="#filtering-the-database"></a>
</h4>
<p>It is possible to remove records with unresolved or invalid names to get a ‘clean’ database. However, to ensure that all records will be evaluated in all the data quality tests (i.e., tests of the taxonomic, spatial, and temporal modules of the package), potentially erroneous or suspect records will be removed in the final module of the package.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># output &lt;-</span></span>
<span><span class="co">#   bdc_filter_out_names(</span></span>
<span><span class="co">#     data = database,</span></span>
<span><span class="co">#     taxonomic_notes = "accepted",</span></span>
<span><span class="co">#     opposite = FALSE</span></span>
<span><span class="co">#   )</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="saving-the-database">
<strong>Saving the database</strong><a class="anchor" aria-label="anchor" href="#saving-the-database"></a>
</h4>
<p>You can use <span class="underline">qs::qsave()</span> instead of write_csv to save a large database in a compressed format.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use qs::qsave() to save the database in a compressed format and then qs:qread() to load the database</span></span>
<span><span class="va">database</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">.</span>,</span>
<span>            <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"Output"</span>, <span class="st">"Intermediate"</span>, <span class="st">"02_taxonomy_database.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bruno Ribeiro, Santiago Velazco, Karlo Guidoni-Martins, Geiziane Tessarolo, Lucas Jardim.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
